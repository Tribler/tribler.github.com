<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Tribler</title>

<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/animate.min.css">
<link rel="stylesheet" href="/css/trac.css" type="text/css" />
<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
<link rel="icon" href="/img/favicon.ico" type="image/x-icon" />

<!--[if lt IE 9]>
<script src="/js/html5shiv.js"></script>
<![endif]-->



<script src="/js/wow.min.js"></script>
<script>
 new WOW().init();
</script>

<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript">
      var uservoiceOptions = {
        /* required */
        key: 'tribler',
        host: 'tribler.uservoice.com',
        forum: '90409',
        showTab: true,
        /* optional */
        alignment: 'right',
        background_color:'#f00',
        text_color: 'white',
        hover_color: '#009ec3',
        lang: 'en'
      };

      function _loadUserVoice() {
        var s = document.createElement('script');
        s.setAttribute('type', 'text/javascript');
        s.setAttribute('src', ("https:" == document.location.protocol ? "https://" : "http://") + "cdn.uservoice.com/javascripts/widgets/tab.js");
        document.getElementsByTagName('head')[0].appendChild(s);
      }
      _loadSuper = window.onload;
      window.onload = (typeof window.onload != 'function') ? _loadUserVoice : function() { _loadSuper(); _loadUserVoice(); };
    </script>

</head>

<body>
	<header>
		<div class="wow fadeInDown">
			<div class="wow fadeInLeft">
				<a href="https://www.facebook.com/TriblerTeam"><img class="facebook-icon" src="/img/facebook-icon.png" /></a>
				<a href="https://twitter.com/TriblerTeam"><img class="twitter-icon" src="/img/twitter-icon.png" /></a>
				<a href="https://github.com/Tribler"><img class="github-icon" src="/img/github-icon.png" /></a>
			</div>
			<a href="/"><img class="header-logo" src="/img/tribler-logo.png" alt="Return to the homepage" /></a>
				
			<nav>
			<ul>
				<li><a href="/">Tribler</a>
				    <ul>
				        <li><a href="/about.html">About Tribler</a></li>
				        <li><a href="/anonymity.html">Towards Anonymity</a></li>
				        <li><a href="https://release.tribler.org/dashboard/">Statistics</a></li>
				    </ul>
				</li>
				<li><a href="/download.html">Download</a></li>
				<li><a href="/support-index.html">Support</a>
				    <ul>
				        <li><a href="/howto.html">Get Started</a></li>
				        <li><a href="/faq.html">FAQ</a></li>
				    </ul>
				</li>
				<li><a href="/developer-index.html">Developers</a>
				    <ul>
					<li><a href="https://github.com/Tribler/tribler">Github</a></li>
					<li><a href="https://github.com/Tribler/tribler/wiki">Wiki</a></li>
					<li><a href="/TitleIndex">Archive</a></li>
				    </ul>
				</li>
				<li><a href="http://forum.tribler.org">Forum</a></li>
			</ul>
		</nav>
	</header>	
	
	<section id="trac"><table><tr><td><h1 id="RichMetadata">Rich Metadata</h1>
<p>
This page describes my work on Rich Metadata done during my MSc thesis at TUDelft. 
</p>
<p>
The goal of the thesis is  to analyse, design, implement and evaluate a possible system that allows dissemination of rich metadata in the context of a P2P overlay, taking into account the intrinsic difficulties that come with this kind of environment, such as full decentralisation and the presence of a big number of nodes for which few assumptions about availability and reliability can be made. In the specific we study a possible solution to integrate subtitles ingestion and distribution within the Tribler P2P Overlay and its Channels abstraction, focusing on the network overhead that would be introduced, on the availability of metadata within the network, and on the quality of usersâÃÃ´ experience.
</p>
<h2 id="FastLinks">Fast Links</h2>
<ul><li>For a quick guide on how to use the system please consult <a class="missing attachment">attachment:user_manual.pdf</a>
</li><li>For API reference: <a class="missing attachment">attachment:api.pdf</a> or <a class="ext-link" href="http://subtitles.zxq.net"><span class="icon">​</span>http://subtitles.zxq.net</a>
</li><li>On the wire protocol description: <a class="missing attachment">attachment:subtitles_on_the_wire_spec.pdf</a>
</li><li>Thesis skeleton (work in progress): attachmento:thesis_skeleton.pdf
</li><li>Preliminar analysis and further ideas (some of them implemented in my work, some others not): <a class="missing attachment">attachment:preliminary_analysys_document.pdf</a>
</li></ul><ul><li>Subtitles code (recently merged with mainbrance): <a class="ext-link" href="http://svn.tribler.org/abc/branches/andrea/d10-05-31-mainbranch-r16034/"><span class="icon">​</span>http://svn.tribler.org/abc/branches/andrea/d10-05-31-mainbranch-r16034/</a>
</li><li>All the other code used for this thesis: <a class="ext-link" href="http://svn.tribler.org/abc/branches/andrea/"><span class="icon">​</span>http://svn.tribler.org/abc/branches/andrea/</a>
</li></ul><p>
For full reference, please consult the attachments at the bottom of this page (some of them are currently work in progress).
</p>
<h2 id="Definitions">Definitions</h2>
<p>
We will introduce here several definitions that will be used throughout this page. The reader is assumed to be familiar with the concepts and terms related to Tribler, especially for what concerns Channels (see <a class="wiki" href="/LivePlaylists">LivePlaylists</a>).
</p>
<dl class="wiki"><dt><strong>(Digital) Item</strong></dt><dd>any kind of digital representable information meant to be consumed by an <em>user</em>.
</dd></dl>
<dl class="wiki"><dt><strong>Content</strong></dt><dd>the representation of an <em>item</em> (e.g. a file)
</dd></dl>
<dl class="wiki"><dt><strong>User</strong></dt><dd>any participant in the P2P Network that can produce, publish and consume <em>items</em>
 
</dd></dl>
<dl class="wiki"><dt><strong>Publisher</strong></dt><dd>An <em>user</em> that advertises one or more <em>items</em> to other users using channels. A publisher does not necessarily coincide with the producer of the âÃÃ¹itemâÃÃ¹, nor it necessarily has to host the content itself.
</dd></dl>
<dl class="wiki"><dt><strong>Channel</strong></dt><dd>A collection of <em>items</em> published by a single <em>publisher</em>. See <a class="wiki" href="/LivePlaylists">LivePlaylists</a>.
</dd></dl>
<dl class="wiki"><dt><strong>Subscriber</strong></dt><dd>An <em>user</em> who expressed its interest in a particular <em>channel</em>
</dd></dl>
<dl class="wiki"><dt><strong>Metadata</strong></dt><dd>Any kind of digital representable knowledge about an <em>item</em>. The implementation will concentrate on textual subtitles. 
</dd></dl>
<dl class="wiki"><dt><strong>Metacontent</strong></dt><dd>The representation of an instance of meta- data (e.g. the file that contains metadata
</dd></dl>
<h2 id="ProblemDescription">Problem Description</h2>
<p>
The focus of this work will be to analyse possible mechanisms and
infrastructures able to allow a content publisher to enrich the object of their publications (items) 
with Rich Metadata (RMD) and to disseminate it to interested consumers within a P2P Network.
</p>
<p>
RMD dissemination can be divided in three different but related aspects, namely:
</p>
<ul><li> Metadata ingestion 
</li><li> Metadata announcement 
</li><li> Metadata retrieval
</li></ul><dl class="wiki"><dt><strong>Metadata ingestion</strong></dt><dd>identifies the process, and the mechanisms involved in it, that allow a publisher to enrich one of the items in its channel with some metadata, and to make this metadata available to other users.
</dd></dl>
<dl class="wiki"><dt><strong>Metadata announcement</strong></dt><dd>is the process and the related set of techniques used in the system in order to inform users of the existence and availability of metadata for a particular item in a channel. It enables users in the system to perform discovery of metadata.
</dd></dl>
<dl class="wiki"><dt><strong>Metadata retrieval</strong></dt><dd>is the process, and the related techniques, through which any user in the system gets the physical representation of a metadata instance, i.e., its metacontent.
</dd></dl>
<h2 id="Preliminaryproblemanalysys">Preliminary problem analysys</h2>
<p>
Please see <a class="missing attachment">attachment:preliminary_analysys_document.pdf</a>. 
</p>
<h2 id="Goals">Goals</h2>
<ul><li><em>Minimize the speed of metadata announcement spread</em> 
</li><li><em>Minimize the bandwidth usage</em>
</li><li><em>Maximize the availability of metacontents throughout the network</em>
</li></ul><h2 id="Assumptions">Assumptions</h2>
<ul><li><em>users are able to instantiate overlay connections to each other</em>: we assume that the middleware providing the P2P Overlay services we are using offers some kind of NAT traversal mechanism allowing peers to exchange messages regardless  them being behind NAT devices.
</li><li><em>publishers are assumed to have a local copy of the rich metacontent they want to publish</em>
</li><li><em>publisher of contents are willing to donate their bandwidth to disseminate their contents for significant amounts of time</em> 
</li></ul><h1 id="SubtitleSupport">Subtitle Support</h1>
<p>
First step towards full Rich Metadata support has been the implementation of a Subtitle Exchange Subsystem integrated in Tribler. 
It is meant to be a seamless extension to the Channels concept, allowing publishers to enrich items in their channels with subtitles in several languages.
</p>
<p>
Please consult the User Guide (<a class="missing attachment">attachment:user_manual.pdf</a>) for a Quick Start tutorial on how to use subtitles.
</p>
<h2 id="DesignOverview">Design Overview</h2>
<ul><li>Using the Subtitle Subsystem an user can publish and disseminates subtitle metacontents for multimedia items distributed via <a class="wiki" href="/BitTorrent">BitTorrent</a>. 
</li><li>Currently only  subtitles in <a class="missing" href="#">http://wiki.videolan.org/SubRip</a> format (aka .srt)  are supported. 
</li><li>Information about published subtitles is disseminated in a gossip-like fashion throughout the network. 
</li><li>Augmented <a class="missing" href="#">ChannelCast</a> protocol: for each gossiped item, also subtitles information is distributed.
</li><li>The actual subtitles contents are requested and sent to interested peers via two new ad-hoc Overlay messages. 
</li><li>DIrect distribution of subtitles trough single messages has been preferred to <a class="wiki" href="/BitTorrent">BitTorrent</a> based transfers because of  the small size of subtitle files (usually less then 100 KBs). The bootstrap time for a bittorrent transfer for such small file would be much greater then the actual download time, thus causing excessive latency time.
</li><li>To increase availability of the published subtitles, we leverage the
</li><li>subscriptions mechanism already implemented in <a class="missing" href="#">ChannelCast</a> trough <a class="missing" href="#">VoteCast</a>:
</li><li>subscribers of a channel automatically download subtitles as soon are they available, thus becoming an additional source for them. 
</li><li>From received gossips peers build a map of available contents sources in order to retrieve them.
</li></ul><h2 id="ProtocolDescription">Protocol Description</h2>
<p>
In this section an informal description of the dissemination and retrieval protocol will be given. A complete and more formal specificiation of the "on-the-wire" protocol can be found here: <a class="missing attachment">attachment:subtitles_on_the_wire_spec.pdf</a> .
</p>
<h3 id="SubtitleIngestion">Subtitle Ingestion</h3>
<p>
To start the ingestion process a publisher must provide a path pointing to the
local copy of the subtitles file, the language of the selected subtitle, and he
has to choose an item previously added to his channel to whom the subtitle are
to be associated.  After that the subsystem performs the following actions:
</p>
<ol><li> Create a copy of the subtitles file and store in the <em>subtitles collecting dir</em>. 
</li></ol><blockquote>
<blockquote>
<p>
To minimize the chance of filename collisions with other collected subtitles, the file is renamed with the hex representation of the SHA-1 digest over the concatenation of the item's <em>infohash</em>, the channel's <em>permid</em> and the 3-characters ISO 639-2 <em>language code</em> of the subtitles. (e.g. b96f1a2398cece6f558ced8d259fd979d2b087ab.srt)
</p>
</blockquote>
</blockquote>
<ol start="2"><li> Insert information about the published subtitles into the appropriate section of the local <a class="wiki" href="/MegaCache">MegaCache</a>
</li><li> Trigger the dissemination process.
</li></ol><h3 id="Subtitlesannouncementdissemination">Subtitles announcement dissemination</h3>
<p>
Availability of subtitles within channels is disseminated  via <a class="missing" href="#">ChannelCast</a>. 
The protocol has been updated and its messages now include information about subtitles for each gossiped torrent. 
</p>
<p>
Attention has been payed to guarantee <strong>full backward compatibility</strong>: old messages are understood by instances running the new protocol, and instances running old versions of the protocol are still able to understand new messages.
</p>
<p>
A <a class="missing" href="#">ChannelCast</a> message is made of several entries: each of them represents an <em>item</em> (i.e. a torrent) published in a channel. Every peer builds the messages he sends including a mix of items from his own channel and from the channels he is subscribed to.
</p>
<p>
Our enhancements of the protocol add to each entry in the message the so called <em>rich metadata entry</em>. In the figure below the contents of this entry are shown.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_announce.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_announce.png"></a>
</p>
<dl class="wiki"><dt><strong>description</strong></dt><dd>is a 500bytes maximum bit string. It is thought to provide a freeform textual description for the item, but it is currently unsed.
</dd><dt><strong>timestamp</strong></dt><dd>is an unix timestamp reflecting the date the rich metadata entry was last modified by its publisher
</dd><dt><strong>languages mask</strong></dt><dd>is a 32-bit string. Each slot in the string
corresponds to one of the supported subtitles languages. Each bit set to the
value '1' means that the moderator has published a subtitle in the
corresponding language. (See <a class="missing attachment">attachment:subtitles_on_the_wire_spec.pdf</a> for a
list of the supported langauges.)
</dd><dt><strong>sha1 checksums</strong></dt><dd>is a list of SHA-1 digests. There is one entry for each published subtitle, corresponding to the hash of the .srt file. This is included to avoid third parties spreading fake copies of subtitles.
</dd><dt><strong>signature</strong></dt><dd>is an ECC signature over the above fields, taken with the
publisher's private key. It can be used by receiving peersto check that the message has not been altered.
</dd><dt><strong>have mask<em></em></strong></dt><dd>is a 32-bit string, similar to the language mask. It represents the subset of the published subtitles which are available at the node who's currently sending the message. This permits the receiving peers to build a map of the physical locations of subtitle contents.
 
</dd></dl>
<h3 id="Subtitlesretrieval">Subtitles retrieval</h3>
<p>
Subtitles are retrieved via a simple asynchronous request response protocol.
</p>
<p>
A peer willing to retrieve the contents of one or more subtitles for an item within a channel can send request messages to peers who announced to have them trough channelcast. Receivers can directly respond with a message including the contents as payload. If the receiving peer does not have the requested content for any reason, he simply discards the request.
</p>
<p>
Two new Overlay Message Types have been introduced to implement the protocol.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_get_subs.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_get_subs.png"></a>
</p>
<p>
<strong>GET_SUBS</strong> (a) is sent by peers as request message
    
<dl class="wiki"><dt><strong>publisher_id</strong></dt><dd>is the PermID identifying the channel where the requested subtitle(s) has been published
</dd><dt><strong>infohash</strong></dt><dd>is the infohash of the item (i.e. the torrent) to whom subtitles are attached.
</dd><dt><strong>request_mask</strong></dt><dd>is a 32-bit string. Each '1' in the string represents a requested subtitle in the corresponding language. In a correct message the request_mask is a valid subset of the languages mask sent during the announcement phase.
</p>
</dd></dl>
<p>
<strong>SUBS</strong> (b) is sent as response to a GET_SUBS request, in the case the requested contents are available.
      
<dl class="wiki"><dt><strong>publisher_id</strong></dt><dd>is the PermID identifying the channel where the requested subtitle(s) has been published
</dd><dt><strong>infohash</strong></dt><dd>is the infohash of the item (i.e. the torrent) to whom subtitles are attached.
</dd><dt><strong>answer_mask</strong></dt><dd>is a 32-bit string. Each '1' in the string represents a subtitle in a given language included in this response message. It is a subset of the request_mask sent along with the GET_SUBS
</dd><dt><strong>payload</strong></dt><dd>is a variable-size list of the UTF-8 encoded subtitle contents. The maximum size of this field is 1 MB.
</p>
</dd></dl>
<p>
An example of the entire diffusion process is shown in the image below.
 
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/example_diff_total.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/example_diff_total.png"></a>
</p>
<p>
The figure represents a sample of the network showing one publisher (green circle), subscribers of his channel (purple circle), and other peers. The  publisher has added two subtitles for an item in its channel, one in Dutch, one in Italian. Yellow shadows underneath the peers mean that the announcement for the subtitles has been received. Vertical and horizontal patterns inside the circles respectively reflect the availability of one of the actual subtitles contents. 
</p>
<ul><li><strong>(a)</strong> The moderator gossips with its (logical) neighborhood about the
</li><li>availability of the two subtitles. The <em>languages mask</em> and the <em>have
</em></li><li>mask<em> are shown above the arrows with list notation. In this case they coincide because the moderator owns both the subtitle contents.
</em></li><li><strong>(b)</strong> As soon as he receives the announcements, the subscriber sends request to the moderator for every subtitle content he has. This is done in order to create replicas of subtitles thus increasing their availability. Another peer also sends request to the moderator, but only for the Italian subtitle.
</li><li><strong>(c)</strong> The subscriber starts to spread information about subtitles trough channelcast. <em>languages mask</em> and <em>have mask</em> are equal also for him, since he owns copies of both the subtitles as well
</li><li><strong>(d)</strong> The moderator goes offline; in the meanwhile the peer who previously requested the Italian subtitles has become a subsciber. He therfore spreads subtitles information via channelcast. This time his <em>have mask</em> only includes the Italian bit, since he does not have a local copy for the Dutch language.
</li></ul><h2 id="Architecture">Architecture</h2>
<p>
In the section the architecture of the Subtitles Subsystem is presented: first we will show the logical organization of software components, their responsibilities and how they integrate with the underlying Tribler platform. Then the focus will move on the single modules that make up the software components and the interactions they perform to achieve the desired behavior.
</p>
<p>
In the figure below a logical view of the macro-blocks of the systems is shown. The components that were already implemented by the platform are pictured in a lighter shade of grey.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch1.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch1.png"></a>
</p>
<dl class="wiki"><dt><strong>RMD Gossip</strong></dt><dd>creates outgoing, and processes incoming gossip messages, managing Rich Metadata (subtitles) information. Implements the necessary extension to the <a class="missing" href="#">ChannelCast</a> module.
</dd><dt><strong>RMD DB</strong></dt><dd>Newly added component of the Tribler <a class="wiki" href="/MegaCache">MegaCache</a>, it manages the information needs of the whole Subtitles Subsystem, facilitating the retrieval and the persistence of rich metadata.
</dd><dt><strong>RMD Fetcher</strong></dt><dd>Implements the request-response protocol described in the previous section. 
</dd><dt><strong>RMD Manager</strong></dt><dd>coordinates the operation of the components in the subsystem.
</dd><dt><strong>RMD User Services</strong></dt><dd>provides an API to be used by clients of the subsystem.
</dd></dl>
<p>
The responsibilities of the above components are further split in the modules they are made of, as shown in the next figure along with their reciprocal dependencies. Please consult the API reference for full details ( <a class="missing attachment">attachment:api.pdf</a> or <a class="ext-link" href="http://subtitles.zxq.net"><span class="icon">​</span>http://subtitles.zxq.net</a> )
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch_dependencies.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch_dependencies.png"></a>
</p>
<p>
In the next figures the basic interactions between these modules are shown in several sequence diagrams. They are not meant to be fully detailed, but to show and let the reader understand the basic program flow. (Click on each figure to  zoom)
</p>
<ul><li>Peer gossiping subtitles.
</li></ul><p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_out.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_out.png" width="800px"></a>
</p>
<ul><li>Peer receiving gossip about subtitles.
</li></ul><p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_in.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_in.png" width="800px"></a>
</p>
<ul><li>Peer creating and sending a subtitle contents request.
</li></ul><p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/request_subtitles.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/request_subtitles.png" width="800px"></a>
</p>
<ul><li>Peer receiving some subtitle contents trough a SUBS message.
</li></ul><p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitles_in.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitles_in.png" width="800px"></a>
</p>
<h2 id="Experimentalresults">Experimental results</h2>
<p>
We have performed several experiments to evaluate the effectiveness of the implemented solution; further evaluation tests are still in progress and will be published on this page as soon as they will be available.
</p>
<p>
The experiments are based on a small scale emulation of peers in the Tribler overlay implementing the subtitle exchange features. 
</p>
<p>
The choice of emulation instead of a more common large scale simulation was
take primarily because we needed a realistic response from the implemented
software, that could also reveal possible problems in a real deployment: our
system was in fact integrated and merged in the P2P Next - Next Share platform,
and the experiments we performed were able to give us a certain degree of
confidence about its reliability.
</p>
<h3 id="ExperimentsFramwork">Experiments Framwork</h3>
<p>
For our emulation we used 7 identical machine. Each of them has the following characteristics:
</p>
<ul><li>8 Intel Xeon E5345 @ 2.33 Ghz CPUs
</li><li>16 GB primary memory
</li><li>Fedora Core 8.something running Linux 2.6.23
</li><li>??Connectivity specs??
</li></ul><p>
All of them were connected to the same LAN segment.
</p>
<p>
On each node 20 instances of Tribler are executed, and each run their <a class="missing" href="#">MegaCaches</a> are reset. The experiment code has been slightly modified with respect to the production code to allow remote control and event logging.
</p>
<p>
Two different settings were explored:
</p>
<ol><li>The emulated Tribler instances are run inside the "official" Tribler Overlay. Therefore they are able to gossip and communicate with "vanilla" versions of the client spread trough the internet.
</li><li>The emulated Tribler instances are run inside an "ad-hoc" isolated Overlay, called <em>Overlay # 42</em>. Inside this overlay they cannot see other peers, and they can only interact each other.
</li></ol><p>
For each of these settings we varied on the uptime of the publisher and on the
number and session characteristics of subscribers.
</p>
<p>
To efficiently analyse the results of each experiment run we also assembled a simple framework whose role is to allow an easy collection, archival and parsing of the logs. The framework, also allows to generate several graphs summarising the basic characteristics of each experiment. 
</p>
<p>
The modified Tribler code can be found at: <a class="ext-link" href="http://svn.tribler.org/abc/branches/andrea/d10-03-30-release5.2-r15178/"><span class="icon">​</span>http://svn.tribler.org/abc/branches/andrea/d10-03-30-release5.2-r15178/</a>
</p>
<p>
The scripts used to run the experiments are available at: <a class="ext-link" href="http://svn.tribler.org/abc/branches/andrea/tribler-run-scripts/"><span class="icon">​</span>http://svn.tribler.org/abc/branches/andrea/tribler-run-scripts/</a>
</p>
<p>
The python code of the parsing and graphing framework are instead at: <a class="ext-link" href="http://svn.tribler.org/abc/branches/andrea/logs-parser/"><span class="icon">​</span>http://svn.tribler.org/abc/branches/andrea/logs-parser/</a>
</p>
<h3 id="Evaluation">Evaluation</h3>
<p>
We wanted an experimental environment able to simulate the swarm dynamics of
real clients, especially for what concerns the churn rate and the uptime length
of single instance. To do so we decided to control the 140+ instances in our experiments based on real Tribler usage traces collected during previous experiments.
</p>
<p>
The traces we used describe the behaviour of 5000 users, including the start
and end of their sessions, their connectability and their downloads actions.
For each experiment run we randomly select 140 users out of the traces, and we
associate each of them to one instance. That instance is then commanded to connect and disconnect from the overlay following the actions of his corresponding real user.
</p>
<p>
The announcement and retrieval phase of our subtitles diffusion solution are
studied introducing in the emulated environment a moderator instance, and
publishing on it a single subtitle for one of its channel items. This
simplification facilitates to trace and measure the parameters we are interested in, without altering the validity of our results. 
The moderating instance is artificially controlled to go up and down depending on the single experiment run,
and - depending on the single experiment - we introduced one or more
subscribers to estimate the effects of their presence.
</p>
<p>
<strong>Swarm Description</strong>
</p>
<p>
We report here some graphs that describe the topology and behavior of the
emulated swarms. Since the traces that guide the peers' sessions are randomly
chosen and different for each experiment, it can be observed that there is a substantial variability in the characteristics of each run.
</p>
<p>
The parameters that we considered to describe swarms behavior are:
</p>
<ul><li>The number of peers connected to the swarm in each instant of simulation time
</li><li>The distribution of session lengths among peers
</li><li>The frequency of churn events in a run (i.e. the frequency of events that modify the topology of the swarm)
</li></ul><p>
For each of them we report below a boxplot graph, describing how this parameter vary among different experiments, and then we report a significative example for each of them.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_stats.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_stats.png" width="380"></a>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_example.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_example.png" width="380"></a>
</p>
<dl class="wiki"><dt><em>number of peers</em></dt><dd>it is higly variable both during a single emulation and
in different emulations: this is due to the randomness in choosing traces.
However the medians in each experiment variy from a minimum of 59
contemporary connected peers to 82. Similarly if the first and third
quartiles in a single experiment are considered, it can be notices that they
vary in a limited range, around 20 peers wide.
</dd></dl>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_stats.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_stats.png" width="380"></a>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_cdf_example.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_cdf_example.png" width="380"></a>
</p>
<dl class="wiki"><dt><em>churn events distribution</em></dt><dd>from the boxplot above it can be seen that in
all the reported experiment runs the churn rate is particularly high, and
that experiments do not vary significantly from each other from this point of
view. In the figure next to it we show the CDF of the churn events for one of
the experiments as an example: it can be seen that the distribution is highly concentrated around the origin of the axis: this means that the interval between two consecutive churn events tends to be very small; in the example 50% of churn events happens within 60 seconds from each other.
</dd></dl>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sess_length_notau_stats.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sess_length_notau_stats.png" width="380"></a>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sesslength_cdf_example.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sesslength_cdf_example.png" width="380"></a>
</p>
<dl class="wiki"><dt><em>session length distribution</em></dt><dd>from the boxplot graph it is easy to see that the session length is highly variable within a single experiment, but more ore less the characteristics of this attribute are the same in different experiments. In the graph on the right the CDF of the session length distribution is shown for a single run. For a lot of peers the session length can be extremely small (less then 90 minutes for the 25 % of the peers), while for the upper 25% it is longer then 12 hours. (We didn't measure sessions longer then 12 hours since our emulations are at most 1 day long. The measurement of sessions longer then half this window would lead to biased results towards short sessions [for an explanation consult the thesis (when it will be written :P ))
</dd></dl>
<p>
<strong>Announcement Overhead</strong>
</p>
<p>
We measured what is the overhead of the subtitle announcement phase, in term of bandwidth on publishers and subscribers, for the current protocol implementation.
The size of a single announcement item can be easily computed a priori:
</p>
<ul><li>2 bytes for  the bencoding of the (empty) description string
</li><li>12 byte string for the timestamp expressed as a bencoded integer
</li><li>6 bytes for the bencoded 32bit languages mask
</li><li>25 bytes for the bencoded list of SHA-1 digests (containing only 1 entry for 1 subtitle)
</li><li>67 bytes for the ECC signature
</li><li>6 bytes for the have mask 
</li><li>2 bytes for the enclosing list.
</li></ul><p>
Making a total of 120 bytes overhead per announcement. 
</p>
<p>
We measured how the bandwidth usage evolves in time: the figures below are shown the results.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_total_announce.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_total_announce.png" width="600"></a>
</p>
<p>
The images above is taken from an experiment run for 24 hours in the official Tribler overlay. The bandwidth used for announcement
periodically grows (in an almost perfect linear fashion) as connections with
the experimental peers are established and gossip with them happens: 
the total consumed bandwidth for one day amounts to only to 25KBytes, confirming that the goal of minimizing overhead is met.
</p>
<p>
Nevertheless 25Kbytes is much more then the minimum required bandwidth to inform all the 140 peers in the simulations: that bandwidth would amount to
140 * 120 bytes = 16 Kbytes.
Therefore there must be a spoil of bandwidth in sending duplicates: this is confirmed in the figure below.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_duplicates_unique.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_duplicates_unique.png" width="600"></a>
</p>
<p>
Nearly the 50% of the announcements sent are duplicates. The fact that
duplicates start to grow only after 4 hours of simulation time is due to the
fact that Tribler block peers with whom he has already gossiped for a window of
that amount. We believe that this isn't  sufficient, since once elapsed the 4 hour timespan the duplicates start to grow way faster then useful announcements.
</p>
<p>
<strong>Announcement Coverage</strong>
</p>
<p>
During our tests we looked at another important parameter of announcement diffusion: we call it the diffusion coverage. In particular we measured the fraction of peers that appeared online at least once who has been reached by an announcement message sent by the moderator or by any subscriber.
</p>
<p>
The following figure shows the evolution of coverage in time for three different experiment settings. The three of them were run in the <em>Overlay # 42</em>, but similar results were also achieved when running the experiment in the official Tribler Overlay.
  
</p>
<ul><li>experiment <em>E1</em> represents the base case. In that scenario we run a moderator continuously for 12 hours.
</li><li>experiment <em>E2</em> differs from E1 in that the moderator goes up and down every 4 hours.
</li><li>experiment <em>E3</em> introduces a subscriber to the same setting of E2
</li></ul><p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage.png" width="600"></a>
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage_zoom.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage_zoom.png" width="600"></a>
</p>
<p>
An important result is that in every case, after around 1500 seconds from the
beginning of the emulation (i.e. 25 minutes) more then the 80% of the appeared
peers has been reached by announcements, and after Â¬â 5000 seconds (i.e. 83
minutes) the coverage is stable between 90% and 100% in E1 and E3.  In E2, instead, the 4 hours of absence of moderator keeping peers fed with its announcements, makes the coverage drop down to 80% as new peers connect to the overlay, but is soon goes up again as the moderator reappears. 
It is important to notice as in E3 the presence of a subscriber manages to compensate the absence of the moderator as he goes down.
</p>
<p>
<strong>Diffusion speed</strong>
</p>
<p>
A central factor for the effectiveness for metadata diffusion is the timely reception of the announcement for a peer. This time represents the window in which a peer searching for an item won't receive results for the corresponding subtitles: therefore we want that window to be as small as possible.
</p>
<p>
In the next figure we show the CDF of waiting times in a single experiment.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/waiting.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/waiting.png" width="600"></a>
</p>
<p>
More then half of the emulated peers receive the announcement within 600 seconds from their first appearance in the overlay, and 90% of them receive it within 1200 seconds.
</p>
<p>
<strong>Subtitles as Overlay Messages: Overhead</strong>
</p>
<p>
We also wanted to measure the impact in terms of bandwidth usage of sending
subtitles in overlay messages. To mimic user behaviour, every emulated Tribler
instance decides to download a subtitle for which he has received an
announcement with a 33% chance. Moreover, since it is unrealistic for an human
user to download a subtitle as soon as he receives the announcement, we delay
the request in time for an amount which follows a uniform distribution in the
window (0, 3600] seconds.
</p>
<p>
Following we show the results for an emulation including one publisher and one
subscriber: the first figure illustrates the total bandwidth used for subtitles
exchange, while the seconds shows how this is split between the publisher and the subscriber. 
The size of the exchanged subtitle is approximately 60Kbytes, covering a film 1:30 long.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_total.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_total.png" width="600"></a>
</p>
<p>
The overhall consumed bandwidth in 12 hours emulation amounts to ~ 3500 KBs. A
slightly faster growth is recognizable in the first part of the emulation, in which the majority of peer's first appearances are concentrated. 
</p>
<p>
Next figure shows how the requests are split between the subscriber and the publisher. Notice that in the middle part of the simulation the publisher's line stops to grow since the moderator goes down for 4 hours.
</p>
<p>
<a class="wiki" href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_mod_subsc.png"><img src="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_mod_subsc.png" width="600"></a>
</p>
<p>
  
</p>
<h2 id="ConclusionsandFutureWork">Conclusions and Future Work</h2>
<p>
<strong>What we have done:</strong>
</p>
<ul><li>Design and implementation of an extension of the <a class="missing" href="#">ChannelCast</a> protocol allowing an user to publish and disseminate Rich Metadata throughout the Overlay Network
</li><li>Design and implementation of a simple asynchronous request-reply protocol, allowing subtitles exchange via Overlay Network messages.
</li><li>Measurements of the implemented solution trough an emulation framework
</li></ul><p>
<strong>What we concluded:</strong>
</p>
<ul><li>The <a class="missing" href="#">ChannelCast</a> extension shows itself to be extremely lightweight, contributing for a 25Kbytes bandwidth overhead in a day.
</li><li>The direct transfer of subtitles trough overlay messages guarantees low latency transfers for small sized contents such subtitles, payed with a small overhead on the publisher and possible subscribers
</li></ul><p>
<strong>What are the limitations:</strong>
</p>
<ul><li>Even if the announcement messages are extremely small, we found that peers exchange a huge number of duplicate messages, accounting for 50% of the announcement traffic. This can become a problem if more complex and rich announcements are to be sent.
</li><li>The mechanism of direct subtitles exchange constitutes a relevant limitation to scalability, since all the peers rely only on the publisher and its possible subscribers to retrieve contents. The bandwidth capacity of the publisher can also constitute a bottleneck: this is even more true if the exchanged contents are bigger in size then simple subtitles files.
</li></ul><p>
<strong>Possible future work:</strong>
</p>
<ul><li>Create an extensible framework to disseminate a broader variety of Metadata (e.g. thumbnails, video previews, timed descriptions or ads...)
</li><li>Work on something able to overcome the <em>duplicates</em> problem (Bloom filters?)
</li><li>Invert the dependency item -&gt; metadata. Now metadata refers to items, but metadata should be the centre of a channel: metadata is what describes an item in a channel. This allows, for example, several physical contents (e.g. videos with different qualities) to be linked to the same item in a channel. Exploring an MPEG-21 like approach could be interesting.
</li></ul><div id="attachments">
<h3 class="foldable">Attachments</h3>
<ul>
<li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/api.pdf">api.pdf</a>
(<span>357.8KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch1.png">arch1.png</a>
(<span>41.6KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/arch_dependencies.png">arch_dependencies.png</a>
(<span>40.9KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_cdf_example.png">churn_cdf_example.png</a>
(<span>12.7KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/churn_stats.png">churn_stats.png</a>
(<span>25.5KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/example_diff_total.png">example_diff_total.png</a>
(<span>135.0KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_example.png">num_peers_example.png</a>
(<span>16.8KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/num_peers_stats.png">num_peers_stats.png</a>
(<span>24.5KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage.png">percentage.png</a>
(<span>37.7KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/percentage_zoom.png">percentage_zoom.png</a>
(<span>23.2KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/preliminary_analysys_document.pdf">preliminary_analysys_document.pdf</a>
(<span>278.6KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_duplicates_unique.png">real_duplicates_unique.png</a>
(<span>15.8KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/real_total_announce.png">real_total_announce.png</a>
(<span>28.2KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/request_subtitles.png">request_subtitles.png</a>
(<span>37.8KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sesslength_cdf_example.png">sesslength_cdf_example.png</a>
(<span>11.1KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/sess_length_notau_stats.png">sess_length_notau_stats.png</a>
(<span>30.7KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_announce.png">subs_announce.png</a>
(<span>15.0KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_get_subs.png">subs_get_subs.png</a>
(<span>17.7KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_mod_subsc.png">subs_mod_subsc.png</a>
(<span>15.5KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subs_total.png">subs_total.png</a>
(<span>31.1KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitles_in.png">subtitles_in.png</a>
(<span>17.4KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitles_on_the_wire_spec.pdf">subtitles_on_the_wire_spec.pdf</a>
(<span>155.8KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_in.png">subtitle_gossiping_in.png</a>
(<span>18.4KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/subtitle_gossiping_out.png">subtitle_gossiping_out.png</a>
(<span>19.9KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/thesis.pdf">thesis.pdf</a>
(<span>3.5MB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/user_manual.pdf">user_manual.pdf</a>
(<span>294.4KB</span>)</li><li><a href="http://kayapo.tribler.org/trac/raw-attachment/wiki/RichMetadata/waiting.png">waiting.png</a>
(<span>14.5KB</span>)</li></ul>
</div></td>
</tr>
</table>
</section>	

</body>
</html>